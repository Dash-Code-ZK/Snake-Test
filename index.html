<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Snake</title>

  <!-- ===================== STYLES ===================== -->
  <style>
    /* ---------- Reset & base ---------- */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: #0a0a0a;
      color: #e0e0e0;
      font-family: 'Courier New', Courier, monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      user-select: none;
      -webkit-user-select: none;
    }

    /* ---------- Header ---------- */
    h1 {
      font-size: 0.7rem;
      font-weight: 400;
      letter-spacing: 0.3em;
      text-transform: uppercase;
      color: #555;
      margin-bottom: 1rem;
    }

    /* ---------- Scoreboard ---------- */
    #scoreboard {
      font-size: 0.75rem;
      letter-spacing: 0.12em;
      color: #555;
      margin-bottom: 1rem;
    }

    #scoreboard .val {
      color: #e0e0e0;
    }

    #scoreboard .sep {
      color: #333;
      margin: 0 0.6em;
    }

    /* ---------- Canvas ---------- */
    canvas {
      border: 1px solid rgba(255, 255, 255, 0.06);
      background: #111;
      display: block;
      image-rendering: pixelated;
    }

    /* ---------- Game-over overlay ---------- */
    #overlay {
      display: none;
      position: absolute;
      width: 400px;
      height: 400px;
      background: rgba(0, 0, 0, 0.85);
      flex-direction: column;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }

    #overlay h2 {
      font-family: 'Courier New', Courier, monospace;
      font-size: 0.85rem;
      font-weight: 400;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: #e0e0e0;
      margin-bottom: 0.6rem;
    }

    #overlay p {
      font-size: 0.75rem;
      letter-spacing: 0.1em;
      color: #555;
      margin-bottom: 1.4rem;
    }

    #playAgainBtn {
      padding: 0.5em 1.6em;
      font-family: 'Courier New', Courier, monospace;
      font-size: 0.7rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      border: 1px solid #333;
      border-radius: 0;
      background: transparent;
      color: #e0e0e0;
      cursor: pointer;
      transition: border-color 0.2s, color 0.2s;
    }

    #playAgainBtn:hover {
      border-color: #00ff88;
      color: #00ff88;
    }

    /* Wrapper keeps the overlay positioned over the canvas */
    #game-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ---------- Mobile touch controls ---------- */
    #touch-controls {
      display: none;
      margin-top: 1.4rem;
      width: 160px;
      height: 160px;
      position: relative;
    }

    .touch-btn {
      position: absolute;
      width: 48px;
      height: 48px;
      border: 1px solid #222;
      border-radius: 0;
      background: transparent;
      color: #555;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: border-color 0.15s, color 0.15s;
    }

    .touch-btn:active {
      border-color: #00ff88;
      color: #00ff88;
    }

    /* Position each d-pad button */
    #btn-up    { top: 0;    left: 50%; transform: translateX(-50%); }
    #btn-down  { bottom: 0; left: 50%; transform: translateX(-50%); }
    #btn-left  { top: 50%;  left: 0;   transform: translateY(-50%); }
    #btn-right { top: 50%;  right: 0;  transform: translateY(-50%); }

    /* Show touch controls on devices that support touch */
    @media (pointer: coarse) {
      #touch-controls { display: block; }
    }
  </style>
</head>

<body>
  <h1>snake</h1>

  <!-- Score display -->
  <div id="scoreboard">
    score <span class="val" id="score">0</span>
    <span class="sep">|</span>
    best <span class="val" id="best">0</span>
  </div>

  <!-- Canvas + game-over overlay -->
  <div id="game-wrapper">
    <canvas id="board" width="400" height="400"></canvas>

    <div id="overlay">
      <h2>game over</h2>
      <p>score: <span id="final-score">0</span></p>
      <button id="playAgainBtn">restart</button>
    </div>
  </div>

  <!-- On-screen d-pad for mobile / touch devices -->
  <div id="touch-controls">
    <button class="touch-btn" id="btn-up"    aria-label="Up">&#9650;</button>
    <button class="touch-btn" id="btn-down"  aria-label="Down">&#9660;</button>
    <button class="touch-btn" id="btn-left"  aria-label="Left">&#9664;</button>
    <button class="touch-btn" id="btn-right" aria-label="Right">&#9654;</button>
  </div>

  <!-- ===================== GAME LOGIC ===================== -->
  <script>
    // ---- Constants ----
    const GRID   = 20;
    const CELL   = 400 / GRID;
    const SPEED  = 120;

    // ---- Canvas setup ----
    const canvas = document.getElementById('board');
    const ctx    = canvas.getContext('2d');

    // ---- DOM references ----
    const scoreEl      = document.getElementById('score');
    const bestEl       = document.getElementById('best');
    const finalScoreEl = document.getElementById('final-score');
    const overlay      = document.getElementById('overlay');
    const playAgainBtn = document.getElementById('playAgainBtn');

    // ---- Persistent high score ----
    let bestScore = parseInt(localStorage.getItem('snake-best') || '0', 10);
    bestEl.textContent = bestScore;

    // ---- Game state variables ----
    let snake, direction, nextDirection, food, score, running, loopId;

    /* ------------------------------------------------
     *  Initialise / reset the game state
     * ------------------------------------------------ */
    function init() {
      snake = [
        { x: 5, y: 10 },
        { x: 4, y: 10 },
        { x: 3, y: 10 }
      ];

      direction     = 'right';
      nextDirection = 'right';
      score         = 0;
      running       = true;

      scoreEl.textContent      = score;
      finalScoreEl.textContent = score;
      overlay.style.display    = 'none';

      placeFood();
      clearInterval(loopId);
      loopId = setInterval(tick, SPEED);
    }

    /* ------------------------------------------------
     *  Place food at a random empty cell
     * ------------------------------------------------ */
    function placeFood() {
      let pos;
      do {
        pos = {
          x: Math.floor(Math.random() * GRID),
          y: Math.floor(Math.random() * GRID)
        };
      } while (snake.some(seg => seg.x === pos.x && seg.y === pos.y));
      food = pos;
    }

    /* ------------------------------------------------
     *  Main game tick
     * ------------------------------------------------ */
    function tick() {
      if (!running) return;

      direction = nextDirection;

      const head = { ...snake[0] };
      if (direction === 'up')    head.y -= 1;
      if (direction === 'down')  head.y += 1;
      if (direction === 'left')  head.x -= 1;
      if (direction === 'right') head.x += 1;

      // Wall collision
      if (head.x < 0 || head.x >= GRID || head.y < 0 || head.y >= GRID) {
        return gameOver();
      }
      // Self collision
      if (snake.some(seg => seg.x === head.x && seg.y === head.y)) {
        return gameOver();
      }

      snake.unshift(head);

      if (head.x === food.x && head.y === food.y) {
        score += 1;
        scoreEl.textContent = score;
        placeFood();
      } else {
        snake.pop();
      }

      draw();
    }

    /* ------------------------------------------------
     *  Render the current frame
     * ------------------------------------------------ */
    function draw() {
      // Clear
      ctx.fillStyle = '#111';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Faint grid
      ctx.strokeStyle = 'rgba(255,255,255,0.02)';
      ctx.lineWidth = 0.5;
      for (let i = 1; i < GRID; i++) {
        ctx.beginPath();
        ctx.moveTo(i * CELL, 0);
        ctx.lineTo(i * CELL, canvas.height);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(0, i * CELL);
        ctx.lineTo(canvas.width, i * CELL);
        ctx.stroke();
      }

      // Snake
      snake.forEach((seg, i) => {
        const brightness = Math.max(0.35, 1 - i * 0.04);
        if (i === 0) {
          ctx.fillStyle = '#00ff88';
        } else {
          ctx.fillStyle = `rgba(0, 255, 136, ${brightness})`;
        }
        ctx.fillRect(seg.x * CELL + 1, seg.y * CELL + 1, CELL - 2, CELL - 2);
      });

      // Food â€” small square
      ctx.fillStyle = '#e0e0e0';
      const inset = 5;
      ctx.fillRect(food.x * CELL + inset, food.y * CELL + inset, CELL - inset * 2, CELL - inset * 2);
    }

    /* ------------------------------------------------
     *  End the current game
     * ------------------------------------------------ */
    function gameOver() {
      running = false;
      clearInterval(loopId);
      finalScoreEl.textContent = score;
      overlay.style.display    = 'flex';

      if (score > bestScore) {
        bestScore = score;
        bestEl.textContent = bestScore;
        localStorage.setItem('snake-best', bestScore);
      }
    }

    /* ------------------------------------------------
     *  Input handling
     * ------------------------------------------------ */
    function setDirection(dir) {
      const opposites = { up: 'down', down: 'up', left: 'right', right: 'left' };
      if (dir === opposites[direction]) return;
      nextDirection = dir;
    }

    document.addEventListener('keydown', e => {
      const map = {
        ArrowUp:    'up',    ArrowDown:  'down',
        ArrowLeft:  'left',  ArrowRight: 'right',
        w: 'up',  s: 'down',  a: 'left',  d: 'right'
      };
      if (map[e.key]) {
        e.preventDefault();
        setDirection(map[e.key]);
      }
    });

    // Touch buttons
    document.getElementById('btn-up').addEventListener('click',    () => setDirection('up'));
    document.getElementById('btn-down').addEventListener('click',  () => setDirection('down'));
    document.getElementById('btn-left').addEventListener('click',  () => setDirection('left'));
    document.getElementById('btn-right').addEventListener('click', () => setDirection('right'));

    // Play again
    playAgainBtn.addEventListener('click', init);

    // Start
    init();
  </script>
</body>
</html>
