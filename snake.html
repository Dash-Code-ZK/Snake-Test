<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Snake Game</title>

  <!-- ===================== STYLES ===================== -->
  <style>
    /* ---------- Reset & base ---------- */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: #1a1a2e;
      color: #eee;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      user-select: none;
      -webkit-user-select: none;
    }

    /* ---------- Header / score ---------- */
    h1 {
      font-size: 1.6rem;
      margin-bottom: 0.3rem;
      letter-spacing: 2px;
      color: #e94560;
    }

    #scoreboard {
      font-size: 1.1rem;
      margin-bottom: 0.6rem;
      color: #aaa;
    }

    #scoreboard span {
      color: #0f3460;
      background: #e94560;
      padding: 2px 10px;
      border-radius: 4px;
      font-weight: bold;
    }

    /* ---------- Canvas ---------- */
    canvas {
      border: 2px solid #e94560;
      border-radius: 4px;
      background: #16213e;
      display: block;
    }

    /* ---------- Game-over overlay ---------- */
    #overlay {
      display: none;                 /* shown via JS when the game ends */
      position: absolute;
      width: 400px;
      height: 400px;
      background: rgba(0, 0, 0, 0.78);
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
    }

    #overlay h2 {
      font-size: 2rem;
      color: #e94560;
      margin-bottom: 0.4rem;
    }

    #overlay p {
      font-size: 1.1rem;
      margin-bottom: 1rem;
      color: #ccc;
    }

    #playAgainBtn {
      padding: 10px 28px;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      background: #e94560;
      color: #fff;
      cursor: pointer;
      transition: background 0.2s;
    }

    #playAgainBtn:hover { background: #c73550; }

    /* Wrapper keeps the overlay positioned over the canvas */
    #game-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ---------- Mobile touch controls ---------- */
    #touch-controls {
      display: none;               /* shown only on touch devices */
      margin-top: 1rem;
      width: 180px;
      height: 180px;
      position: relative;
    }

    .touch-btn {
      position: absolute;
      width: 56px;
      height: 56px;
      border: none;
      border-radius: 12px;
      background: #0f3460;
      color: #e94560;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.15s;
    }

    .touch-btn:active { background: #e94560; color: #fff; }

    /* Position each d-pad button */
    #btn-up    { top: 0;    left: 50%; transform: translateX(-50%); }
    #btn-down  { bottom: 0; left: 50%; transform: translateX(-50%); }
    #btn-left  { top: 50%;  left: 0;   transform: translateY(-50%); }
    #btn-right { top: 50%;  right: 0;  transform: translateY(-50%); }

    /* Show touch controls on devices that support touch */
    @media (pointer: coarse) {
      #touch-controls { display: block; }
    }
  </style>
</head>

<body>
  <h1>SNAKE</h1>

  <!-- Score display -->
  <div id="scoreboard">Score: <span id="score">0</span></div>

  <!-- Canvas + game-over overlay -->
  <div id="game-wrapper">
    <canvas id="board" width="400" height="400"></canvas>

    <div id="overlay">
      <h2>Game Over</h2>
      <p>Score: <span id="final-score">0</span></p>
      <button id="playAgainBtn">Play Again</button>
    </div>
  </div>

  <!-- On-screen d-pad for mobile / touch devices -->
  <div id="touch-controls">
    <button class="touch-btn" id="btn-up"    aria-label="Up">&#9650;</button>
    <button class="touch-btn" id="btn-down"  aria-label="Down">&#9660;</button>
    <button class="touch-btn" id="btn-left"  aria-label="Left">&#9664;</button>
    <button class="touch-btn" id="btn-right" aria-label="Right">&#9654;</button>
  </div>

  <!-- ===================== GAME LOGIC ===================== -->
  <script>
    // ---- Constants ----
    const GRID   = 20;               // number of cells per row/column
    const CELL   = 400 / GRID;       // pixel size of each cell (20 px)
    const SPEED  = 120;              // milliseconds between ticks

    // ---- Canvas setup ----
    const canvas = document.getElementById('board');
    const ctx    = canvas.getContext('2d');

    // ---- DOM references ----
    const scoreEl      = document.getElementById('score');
    const finalScoreEl = document.getElementById('final-score');
    const overlay      = document.getElementById('overlay');
    const playAgainBtn = document.getElementById('playAgainBtn');

    // ---- Game state variables (reset each round) ----
    let snake, direction, nextDirection, food, score, running, loopId;

    /* ------------------------------------------------
     *  Initialise / reset the game state
     * ------------------------------------------------ */
    function init() {
      // Snake starts in the middle, 3 segments long, heading right
      snake = [
        { x: 5, y: 10 },
        { x: 4, y: 10 },
        { x: 3, y: 10 }
      ];

      direction     = 'right';      // current movement direction
      nextDirection = 'right';      // buffered input (applied next tick)
      score         = 0;
      running       = true;

      scoreEl.textContent      = score;
      finalScoreEl.textContent = score;
      overlay.style.display    = 'none';

      placeFood();                   // drop the first food item
      clearInterval(loopId);
      loopId = setInterval(tick, SPEED);  // start the game loop
    }

    /* ------------------------------------------------
     *  Place food at a random empty cell
     * ------------------------------------------------ */
    function placeFood() {
      let pos;
      do {
        pos = {
          x: Math.floor(Math.random() * GRID),
          y: Math.floor(Math.random() * GRID)
        };
        // make sure food doesn't appear on the snake
      } while (snake.some(seg => seg.x === pos.x && seg.y === pos.y));
      food = pos;
    }

    /* ------------------------------------------------
     *  Main game tick — called every SPEED ms
     * ------------------------------------------------ */
    function tick() {
      if (!running) return;

      // Apply the buffered direction so rapid key presses don't cause 180° turns
      direction = nextDirection;

      // Calculate new head position
      const head = { ...snake[0] };
      if (direction === 'up')    head.y -= 1;
      if (direction === 'down')  head.y += 1;
      if (direction === 'left')  head.x -= 1;
      if (direction === 'right') head.x += 1;

      // ---- Collision detection ----
      // Wall collision
      if (head.x < 0 || head.x >= GRID || head.y < 0 || head.y >= GRID) {
        return gameOver();
      }
      // Self collision
      if (snake.some(seg => seg.x === head.x && seg.y === head.y)) {
        return gameOver();
      }

      // Add new head
      snake.unshift(head);

      // ---- Food check ----
      if (head.x === food.x && head.y === food.y) {
        score += 1;
        scoreEl.textContent = score;
        placeFood();
        // Don't remove the tail — the snake grows by one segment
      } else {
        snake.pop();                 // remove tail to keep the same length
      }

      draw();
    }

    /* ------------------------------------------------
     *  Render the current frame
     * ------------------------------------------------ */
    function draw() {
      // Clear canvas
      ctx.fillStyle = '#16213e';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Draw snake segments
      snake.forEach((seg, i) => {
        ctx.fillStyle = i === 0 ? '#e94560' : '#0f3460';   // head is accent colour
        ctx.fillRect(seg.x * CELL + 1, seg.y * CELL + 1, CELL - 2, CELL - 2);

        // Subtle inner highlight
        ctx.fillStyle = i === 0 ? '#ff6b81' : '#1a5276';
        ctx.fillRect(seg.x * CELL + 3, seg.y * CELL + 3, CELL - 6, CELL - 6);
      });

      // Draw food
      ctx.fillStyle = '#e94560';
      ctx.beginPath();
      ctx.arc(
        food.x * CELL + CELL / 2,
        food.y * CELL + CELL / 2,
        CELL / 2 - 2,
        0, Math.PI * 2
      );
      ctx.fill();
    }

    /* ------------------------------------------------
     *  End the current game
     * ------------------------------------------------ */
    function gameOver() {
      running = false;
      clearInterval(loopId);
      finalScoreEl.textContent = score;
      overlay.style.display    = 'flex';
    }

    /* ------------------------------------------------
     *  Input handling — keyboard (arrow keys + WASD)
     * ------------------------------------------------ */
    function setDirection(dir) {
      // Prevent reversing into the snake's own body
      const opposites = { up: 'down', down: 'up', left: 'right', right: 'left' };
      if (dir === opposites[direction]) return;
      nextDirection = dir;
    }

    document.addEventListener('keydown', e => {
      const map = {
        ArrowUp:    'up',    ArrowDown:  'down',
        ArrowLeft:  'left',  ArrowRight: 'right',
        w: 'up',  s: 'down',  a: 'left',  d: 'right'
      };
      if (map[e.key]) {
        e.preventDefault();          // stop page scrolling on arrow keys
        setDirection(map[e.key]);
      }
    });

    /* ------------------------------------------------
     *  Input handling — on-screen touch buttons
     * ------------------------------------------------ */
    document.getElementById('btn-up').addEventListener('click',    () => setDirection('up'));
    document.getElementById('btn-down').addEventListener('click',  () => setDirection('down'));
    document.getElementById('btn-left').addEventListener('click',  () => setDirection('left'));
    document.getElementById('btn-right').addEventListener('click', () => setDirection('right'));

    /* ------------------------------------------------
     *  Play Again button
     * ------------------------------------------------ */
    playAgainBtn.addEventListener('click', init);

    /* ------------------------------------------------
     *  Start the first game
     * ------------------------------------------------ */
    init();
  </script>
</body>
</html>
